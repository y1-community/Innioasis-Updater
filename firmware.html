<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Innioasis Y1 Firmware</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* Light mode colors */
            --bg-primary: #ffffff;
            --bg-secondary: #f5f5f7;
            --bg-tertiary: #fafafa;
            --text-primary: #1d1d1f;
            --text-secondary: #86868b;
            --text-tertiary: #6e6e73;
            --accent-primary: #007aff;
            --accent-secondary: #5856d6;
            --accent-success: #34c759;
            --accent-warning: #ff9500;
            --accent-error: #ff3b30;
            --border-primary: #d2d2d7;
            --border-secondary: #e5e5e7;
            --shadow-primary: rgba(0, 0, 0, 0.1);
            --shadow-secondary: rgba(0, 0, 0, 0.05);
            --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-secondary: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        [data-theme="dark"] {
            /* Dark mode colors */
            --bg-primary: #000000;
            --bg-secondary: #1c1c1e;
            --bg-tertiary: #2c2c2e;
            --text-primary: #ffffff;
            --text-secondary: #98989d;
            --text-tertiary: #8e8e93;
            --accent-primary: #0a84ff;
            --accent-secondary: #5e5ce6;
            --accent-success: #30d158;
            --accent-warning: #ff9f0a;
            --accent-error: #ff453a;
            --border-primary: #38383a;
            --border-secondary: #48484a;
            --shadow-primary: rgba(0, 0, 0, 0.3);
            --shadow-secondary: rgba(0, 0, 0, 0.2);
            --gradient-primary: linear-gradient(135deg, #1c1c1e 0%, #2c2c2e 100%);
            --gradient-secondary: linear-gradient(135deg, #2c2c2e 0%, #3a3a3c 100%);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'SF Pro Text', 'Helvetica Neue', Helvetica, Arial, sans-serif;
            background: var(--bg-primary);
            min-height: 100vh;
            color: var(--text-primary);
            line-height: 1.6;
            transition: all 0.3s ease;
        }

        /* Dark mode styles */
        body[data-theme="dark"] {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: #f8f9fa;
        }

        body[data-theme="dark"] .main-content {
            background: #2c2c2e;
            color: #ffffff;
        }

        body[data-theme="dark"] .filters {
            background: #3a3a3c;
            color: #ffffff;
            border-color: #48484a;
        }

        body[data-theme="dark"] .filter-group label {
            color: #ffffff;
        }

        body[data-theme="dark"] .filter-group select {
            background: #2c2c2e;
            color: #ffffff;
            border-color: #48484a;
        }

        body[data-theme="dark"] .firmware-list {
            color: #ffffff;
        }

        body[data-theme="dark"] .firmware-item {
            background: #3a3a3c;
            color: #ffffff;
            border-color: #48484a;
        }

        body[data-theme="dark"] .firmware-name {
            color: #ffffff;
        }

        body[data-theme="dark"] .detail-label {
            color: #8e8e93;
        }

        body[data-theme="dark"] .detail-value {
            color: #c7c7cc;
        }

        body[data-theme="dark"] .platform-dialog {
            background: #2c2c2e;
            color: #ffffff;
            border-color: #48484a;
        }

        body[data-theme="dark"] .platform-dialog h3 {
            color: #ffffff;
        }

        body[data-theme="dark"] .platform-dialog p {
            color: #c7c7cc;
        }

        body[data-theme="dark"] .step-content {
            background: #3a3a3c;
            color: #ffffff;
            border-color: #48484a;
        }

        body[data-theme="dark"] .step-content h4 {
            color: #8e8e93;
        }

        body[data-theme="dark"] .step-content p {
            color: #c7c7cc;
        }

        body[data-theme="dark"] .step-content li {
            color: #c7c7cc;
        }

        body[data-theme="dark"] .driver-item {
            background: #3a3a3c;
            color: #ffffff;
            border-color: #48484a;
        }

        body[data-theme="dark"] .driver-item p {
            color: #c7c7cc;
        }

        body[data-theme="dark"] .command-display {
            background: #3a3a3c;
            border-color: #48484a;
        }

        body[data-theme="dark"] .command-display code {
            color: #c7c7cc;
        }

        body[data-theme="dark"] .alternative-link {
            color: #8e8e93;
        }

        body[data-theme="dark"] .alternative-link:hover {
            color: #c7c7cc;
        }

        body[data-theme="dark"] .footer {
            color: white;
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.2);
        }

        body[data-theme="dark"] .footer a {
            color: white;
        }

        body[data-theme="dark"] .platform-dialog p {
            color: #ffffff;
        }


        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 15px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
            position: relative;
        }

        .theme-toggle {
            position: absolute;
            top: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.15);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 12px 18px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1.1rem;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            backdrop-filter: blur(15px);
            font-weight: 600;
            min-width: 120px;
            justify-content: center;
        }

        .theme-toggle:hover {
            background: rgba(255, 255, 255, 0.25);
            border-color: rgba(255, 255, 255, 0.5);
            transform: translateY(-2px);
        }

        .theme-toggle .icon {
            font-size: 1.3rem;
        }

        .header-icon {
            width: 80px;
            height: 80px;
            border-radius: 20px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
            transition: transform 0.3s ease;
        }

        .header-icon:hover {
            transform: scale(1.05);
        }

        .header-text {
            flex: 1;
            min-width: 300px;
        }

        .header h1 {
            font-size: 2.2rem;
            margin-bottom: 8px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1rem;
            opacity: 0.9;
        }

        .main-content {
            background: var(--bg-secondary);
            border-radius: 24px;
            padding: 30px;
            box-shadow: 0 8px 32px var(--shadow-primary);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border-secondary);
        }

        .filters {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
            padding: 25px;
            background: var(--bg-primary);
            border-radius: 20px;
            border: 1px solid var(--border-secondary);
            box-shadow: 0 4px 16px var(--shadow-secondary);
        }

        .filter-group {
            display: flex;
            flex-direction: column;
        }

        .filter-group label {
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-primary);
            font-size: 0.9rem;
            letter-spacing: -0.01em;
        }

        .filter-group select {
            padding: 12px 16px;
            border: 1px solid var(--border-primary);
            border-radius: 12px;
            font-size: 14px;
            background: var(--bg-primary);
            color: var(--text-primary);
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .filter-group select:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.1);
        }

        .refresh-btn {
            background: var(--accent-primary);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            align-self: end;
            font-size: 0.9rem;
            font-family: inherit;
            box-shadow: 0 4px 16px rgba(0, 122, 255, 0.3);
        }

        .refresh-btn:hover {
            transform: translateY(-2px);
        }

        .refresh-btn:active {
            transform: translateY(0);
        }

        .firmware-list {
            background: var(--bg-primary);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 30px;
            border: 1px solid var(--border-secondary);
            box-shadow: 0 4px 16px var(--shadow-secondary);
        }

        .firmware-list h3 {
            margin-bottom: 20px;
            color: var(--text-primary);
            font-size: 1.3rem;
            font-weight: 700;
            letter-spacing: -0.02em;
        }

        .firmware-item {
            background: white;
            border-radius: 12px;
            padding: 18px;
            margin-bottom: 12px;
            border: 1px solid #e9ecef;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .firmware-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            border-color: #667eea;
        }

        .firmware-item.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, #f8f9ff 0%, #f0f2ff 100%);
        }

        .firmware-name {
            font-size: 1.1rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 8px;
            position: relative;
            overflow: hidden;
        }

        /* Pill styles for version designations */
        .version-pills {
            display: flex;
            gap: 8px;
            margin-top: 8px;
            flex-wrap: wrap;
        }

        .version-pill {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            white-space: nowrap;
        }

        .version-pill.ipod-theme {
            background: #007aff;
            color: white;
        }
        
        .version-pill.ipod-theme::before {
            content: "✅ ";
            margin-right: 4px;
        }

        .version-pill.resolution-360p {
            background: #ffd700;
            color: #1d1d1f;
        }

        .version-pill.nightly {
            background: #ff9500;
            color: white;
        }

        .version-pill.wifi {
            background: #34c759;
            color: white;
        }

        .version-pill.bluetooth {
            background: #007aff;
            color: white;
        }

        .version-pill.usb {
            background: #8e8e93;
            color: white;
        }

        .version-pill.ethernet {
            background: #5856d6;
            color: white;
        }

        .version-pill.hdmi {
            background: #ff3b30;
            color: white;
        }

        .version-pill.audio {
            background: #af52de;
            color: white;
        }

        .version-pill.video {
            background: #ff2d92;
            color: white;
        }

        .version-pill.camera {
            background: #ff9500;
            color: white;
        }

        .version-pill.gps {
            background: #32d74b;
            color: white;
        }

        .version-pill.nfc {
            background: #5ac8fa;
            color: white;
        }

        .version-pill.lte {
            background: #ffcc00;
            color: #000000;
        }

        .version-pill.generic {
            background: #8e8e93;
            color: white;
        }

        /* Dark mode support for pills */
        body[data-theme="dark"] .version-pill.ipod-theme {
            background: #0a84ff;
            color: white;
        }
        
        body[data-theme="dark"] .version-pill.ipod-theme::before {
            content: "✅ ";
            margin-right: 4px;
        }

        body[data-theme="dark"] .version-pill.resolution-360p {
            background: #ff9f0a;
            color: #000000;
        }

        body[data-theme="dark"] .version-pill.nightly {
            background: #ff9f0a;
            color: white;
        }

        body[data-theme="dark"] .version-pill.wifi {
            background: #30d158;
            color: #000000;
        }

        body[data-theme="dark"] .version-pill.bluetooth {
            background: #0a84ff;
            color: white;
        }

        body[data-theme="dark"] .version-pill.usb {
            background: #8e8e93;
            color: white;
        }

        body[data-theme="dark"] .version-pill.ethernet {
            background: #5e5ce6;
            color: white;
        }

        body[data-theme="dark"] .version-pill.hdmi {
            background: #ff453a;
            color: white;
        }

        body[data-theme="dark"] .version-pill.audio {
            background: #bf5af2;
            color: white;
        }

        body[data-theme="dark"] .version-pill.video {
            background: #ff375f;
            color: white;
        }

        body[data-theme="dark"] .version-pill.camera {
            background: #ff9f0a;
            color: #000000;
        }

        body[data-theme="dark"] .version-pill.gps {
            background: #32d74b;
            color: #000000;
        }

        body[data-theme="dark"] .version-pill.nfc {
            background: #64d2ff;
            color: #000000;
        }

        body[data-theme="dark"] .version-pill.lte {
            background: #ffd60a;
            color: #000000;
        }

        body[data-theme="dark"] .version-pill.generic {
            background: #8e8e93;
            color: white;
        }

        /* Scrolling text animation for long version names */
        .detail-value.scroll-text {
            white-space: nowrap;
            animation: scrollText 10s linear infinite;
            cursor: pointer;
            position: relative;
            display: inline-block;
            max-width: 200px;
            overflow: hidden;
        }

        .detail-value.scroll-text:hover {
            animation-play-state: paused;
            white-space: normal;
            overflow: visible;
            max-width: none;
        }

        /* Touch devices - pause animation on touch */
        .detail-value.scroll-text:active {
            animation-play-state: paused;
        }

        @keyframes scrollText {
            0% {
                transform: translateX(0);
            }
            20% {
                transform: translateX(0);
            }
            80% {
                transform: translateX(calc(-100% + 200px));
            }
            100% {
                transform: translateX(calc(-100% + 200px));
            }
        }

        /* Pause animation when user is interacting */
        .firmware-item:hover .scroll-text {
            animation-play-state: paused;
        }

        /* Ensure detail items have proper width constraints */
        .detail-item {
            display: flex;
            flex-direction: column;
            min-width: 0;
            max-width: 250px;
        }

        .detail-value {
            word-break: break-word;
            overflow-wrap: break-word;
        }


        .firmware-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 12px;
            margin-bottom: 15px;
        }

        .detail-item {
            display: flex;
            flex-direction: column;
        }

        .detail-label {
            font-size: 0.75rem;
            color: #6c757d;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }

        .detail-value {
            font-weight: 600;
            color: #495057;
            font-size: 0.9rem;
        }

        .download-btn {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
        }

        .download-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(40, 167, 69, 0.3);
        }

        .download-btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
        }

        .download-section {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .whats-new-btn {
            background: linear-gradient(135deg, #007aff 0%, #0051d5 100%);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            width: 100%;
            font-size: 0.9rem;
            font-weight: 600;
            box-shadow: 0 3px 10px rgba(0, 122, 255, 0.3);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }

        .whats-new-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0, 122, 255, 0.4);
            background: linear-gradient(135deg, #0051d5 0%, #003d99 100%);
        }

        .download-rom-btn {
            background: #6c757d;
            color: white;
            border: 1px solid #5a6268;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            font-size: 0.75rem;
            opacity: 0.7;
        }

        .download-rom-btn:hover {
            background: #5a6268;
            opacity: 0.9;
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .automatic-install-btn {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border: none;
            padding: 14px 24px;
            border-radius: 10px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            font-size: 1.1rem;
            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .automatic-install-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(40, 167, 69, 0.4);
            background: linear-gradient(135deg, #218838 0%, #1e7e34 100%);
        }

        .status {
            text-align: center;
            padding: 8px 12px;
            background: transparent;
            border-radius: 6px;
            margin-bottom: 12px;
            border: none;
            font-size: 0.9rem;
            opacity: 0.7;
            color: var(--text-secondary);
        }

        .status.error {
            background: rgba(255, 59, 48, 0.1);
            color: var(--accent-error);
            opacity: 1;
        }

        .status.loading {
            background: rgba(255, 149, 0, 0.1);
            color: var(--accent-warning);
            opacity: 1;
        }
        

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            width: 0%;
            transition: width 0.3s ease;
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .footer {
            text-align: center;
            margin-top: 30px;
            color: var(--text-primary);
            opacity: 0.8;
            padding: 20px;
            background: var(--bg-secondary);
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid var(--border-primary);
        }

        .footer a {
            color: var(--accent-primary);
            text-decoration: none;
            transition: opacity 0.3s ease;
        }

        .footer a:hover {
            text-decoration: underline;
            opacity: 1;
        }



        /* Platform-specific dialog styles */
        .platform-dialog {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            z-index: 2000;
            max-width: 500px;
            width: 90%;
            text-align: center;
            display: none;
        }

        .platform-dialog.show {
            display: block;
        }

        .platform-dialog h3 {
            color: #e74c3c;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .platform-dialog p {
            margin-bottom: 20px;
            line-height: 1.6;
            color: var(--text-primary);
        }

        .platform-dialog .btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 0 10px;
        }

        .platform-dialog .btn:hover {
            background: #c0392b;
            transform: translateY(-2px);
        }

        .platform-dialog .btn-secondary {
            background: #6c757d;
        }

        .platform-dialog .btn-secondary:hover {
            background: #5a6268;
        }

        /* Platform Guides Grid */
        .platform-guides-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .platform-guide-btn {
            padding: 15px 10px;
            font-size: 0.9rem;
            min-height: 60px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }

        .dialog-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1999;
            display: none;
        }

        .dialog-overlay.show {
            display: block;
        }

        /* Command box styles */
        .command-box {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-primary);
            border-radius: 12px;
            padding: 16px;
            margin: 15px 0;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
        }

        .command-box code {
            background: var(--bg-primary);
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid var(--border-secondary);
            font-size: 0.9rem;
            color: var(--text-primary);
            flex: 1;
            word-break: break-all;
        }

        .copy-btn {
            background: var(--accent-primary);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .copy-btn:hover {
            background: var(--accent-secondary);
            transform: translateY(-1px);
        }

        .copy-btn:active {
            transform: translateY(0);
        }

        @media (max-width: 768px) {
            
            .container {
                padding: 10px;
            }
            
            .header {
                flex-direction: column;
                gap: 15px;
            }
            
            .header-icon {
                width: 60px;
                height: 60px;
            }
            
            .header h1 {
                font-size: 1.8rem;
            }
            
            .main-content {
                padding: 20px;
            }
            
            .filters {
                grid-template-columns: 1fr;
                gap: 12px;
            }
            
            .firmware-details {
                grid-template-columns: 1fr;
            }
            
            /* Mobile-specific scrolling text improvements */
            .detail-value.scroll-text {
                animation-duration: 6s; /* Faster on mobile */
                touch-action: pan-x; /* Allow horizontal scrolling on touch */
                max-width: 150px; /* Smaller max width on mobile */
            }
            
            .detail-item {
                max-width: 180px; /* Smaller max width on mobile */
            }
            
        }
        
        @media (max-width: 480px) {
            .header h1 {
                font-size: 1.5rem;
            }
            
            .header p {
                font-size: 0.9rem;
            }
            
            .container {
                padding: 8px;
            }
            
            .main-content {
                padding: 15px;
            }
        }

        /* macOS Installation Steps */
        .mac-step {
            text-align: left;
            margin: 20px 0;
        }

        .step-content {
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .step-content h4 {
            color: #667eea;
            margin: 0 0 15px 0;
            font-size: 1.2rem;
        }

        .step-content p {
            margin: 12px 0;
            line-height: 1.6;
        }

        .step-content ol {
            margin: 15px 0;
            padding-left: 20px;
        }

        .step-content li {
            margin: 8px 0;
            line-height: 1.5;
        }

        .step-actions {
            margin-top: 25px;
            text-align: center;
        }

        .step-actions .btn {
            margin: 0 10px;
        }

        .alternative-install {
            text-align: center;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #dee2e6;
        }

        .alternative-link {
            color: #6c757d;
            text-decoration: none;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .alternative-link:hover {
            color: #495057;
            text-decoration: underline;
        }

        /* Checklist Styles */
        .checklist {
            margin: 20px 0;
        }

        .checklist-item {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 12px;
            transition: all 0.3s ease;
        }

        .checklist-item:hover {
            background: #f1f3f4;
            border-color: #dee2e6;
        }

        .checklist-content h5 {
            margin: 0 0 8px 0;
            color: #2c3e50;
            font-size: 1.1rem;
        }

        .checklist-content p {
            margin: 0 0 12px 0;
            color: #6c757d;
            font-size: 0.9rem;
        }

        /* Dark mode support for checklist items */
        body[data-theme="dark"] .checklist-item {
            background: #2c2c2e;
            border-color: #48484a;
        }

        body[data-theme="dark"] .checklist-item:hover {
            background: #3a3a3c;
            border-color: #5a5a5c;
        }

        body[data-theme="dark"] .checklist-content h5 {
            color: #ffffff;
        }

        body[data-theme="dark"] .checklist-content p {
            color: #c7c7cc;
        }

        .checklist-actions {
            display: flex;
            align-items: center;
            gap: 12px;
            flex-wrap: wrap;
        }

        .info-btn {
            background: #6c757d;
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .info-btn:hover {
            background: #5a6268;
            transform: scale(1.1);
        }

        .skip-link {
            color: #6c757d;
            text-decoration: none;
            font-size: 0.85rem;
            font-style: italic;
            transition: color 0.3s ease;
        }

        .skip-link:hover {
            color: #495057;
            text-decoration: underline;
        }

        /* Info Modal Styles */
        .info-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000001;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .info-modal.show {
            display: flex;
        }

        .info-modal-content {
            background: white;
            padding: 24px;
            border-radius: 12px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            position: relative;
        }

        .info-modal-close {
            position: absolute;
            top: 12px;
            right: 16px;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #6c757d;
        }

        .info-modal h3 {
            margin: 0 0 16px 0;
            color: #2c3e50;
        }

        .info-modal p {
            margin: 0 0 12px 0;
            line-height: 1.6;
        }

        .info-modal .highlight {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 6px;
            padding: 12px;
            margin: 16px 0;
        }

        .info-modal .highlight strong {
            color: #856404;
        }

        /* Dark mode support for info modal */
        body[data-theme="dark"] .info-modal-content {
            background: #2c2c2e;
            color: #ffffff;
        }

        /* What's New Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .whats-new-modal {
            background: white;
            border-radius: 12px;
            max-width: 600px;
            max-height: 80vh;
            width: 90%;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            margin: 0;
            color: #2c3e50;
            font-size: 1.3rem;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-btn:hover {
            color: #000;
        }

        .modal-body {
            padding: 20px;
            max-height: 60vh;
            overflow-y: auto;
        }

        .release-notes {
            line-height: 1.6;
            color: #333;
        }

        .release-notes h1, .release-notes h2, .release-notes h3 {
            color: #2c3e50;
            margin-top: 20px;
            margin-bottom: 10px;
        }

        .release-notes h1 {
            font-size: 1.5rem;
        }

        .release-notes h2 {
            font-size: 1.3rem;
        }

        .release-notes h3 {
            font-size: 1.1rem;
        }

        .release-notes ul {
            padding-left: 20px;
        }

        .release-notes li {
            margin-bottom: 5px;
        }

        .release-notes code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }

        .loading-spinner {
            text-align: center;
            color: #666;
            font-style: italic;
        }

        /* Dark mode support for What's New modal */
        body[data-theme="dark"] .whats-new-modal {
            background: #2c2c2e;
            color: #ffffff;
        }

        body[data-theme="dark"] .modal-header {
            border-bottom-color: #48484a;
        }

        body[data-theme="dark"] .modal-header h3 {
            color: #ffffff;
        }

        body[data-theme="dark"] .close-btn {
            color: #8e8e93;
        }

        body[data-theme="dark"] .close-btn:hover {
            color: #ffffff;
        }

        body[data-theme="dark"] .release-notes {
            color: #ffffff;
        }

        body[data-theme="dark"] .release-notes h1,
        body[data-theme="dark"] .release-notes h2,
        body[data-theme="dark"] .release-notes h3 {
            color: #ffffff;
        }

        body[data-theme="dark"] .release-notes code {
            background: #48484a;
            color: #ffffff;
        }

        body[data-theme="dark"] .info-modal h3 {
            color: #ffffff;
        }

        body[data-theme="dark"] .info-modal p {
            color: #c7c7cc;
        }

        body[data-theme="dark"] .info-modal .highlight {
            background: #3a3a3c;
            border-color: #5a5a5c;
        }

        body[data-theme="dark"] .info-modal .highlight strong {
            color: #ffd700;
        }

        body[data-theme="dark"] .info-modal-close {
            color: #c7c7cc;
        }
    </style>
</head>
<body>
    <!-- Driver Info Modal -->
    <div class="info-modal" id="driverInfoModal">
        <div class="info-modal-content">
            <button class="info-modal-close" onclick="closeDriverInfo()">×</button>
            <h3>📥 MediaTek Driver Installation Info</h3>
            <p>When installing the MediaTek driver, you may see a dialog asking about removing the "origin driver". Here's what to do:</p>
            
            <div class="highlight">
                <strong>Important:</strong> If the installer asks "Remove origin driver?", click <strong>Yes</strong>. This is normal and helps ensure the driver works properly with your Y1 device.
            </div>
            
            <p>This step is necessary because:</p>
            <ul>
                <li>It removes any conflicting drivers that might interfere</li>
                <li>It ensures the MediaTek driver has full control over USB communication</li>
                <li>It prevents driver conflicts that could cause connection issues</li>
            </ul>
            
            <p>After installation, restart your computer as prompted to complete the setup.</p>
        </div>
    </div>

    <div class="container">
        <div class="header">
            <img src="mtkclient/gui/images/icon.png" alt="Innioasis Icon" class="header-icon">
            <div class="header-text">
                <h1>Innioasis Y1 Firmware Directory</h1>
                <p>Download firmware releases directly from Slidia</p>
            </div>
            <button class="theme-toggle" onclick="toggleTheme()">
                <span class="icon">🌓</span>
                <span>Auto</span>
            </button>
        </div>

        <div class="main-content">

            <div class="filters">
                <div class="filter-group">
                    <label for="deviceType">Device Type</label>
                    <select id="deviceType">
                    </select>
                </div>
                
                <div class="filter-group">
                    <label for="deviceModel">Device Model</label>
                    <select id="deviceModel">
                        <option value="">All Models</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label for="software">Software</label>
                    <select id="software">
                    </select>
                </div>
                
                <button class="refresh-btn" onclick="refreshData()">
                    🔄 Refresh
                </button>
            </div>
            

            <div class="status" id="status">
                Ready to download system software
            </div>

            <div class="firmware-list">
                <h3 id="availableSoftwareTitle">Available System Software</h3>
                <div id="firmwareContainer">
                    <p style="text-align: center; color: #6c757d;">Select filters and click refresh to load system software</p>
                </div>
            </div>
        </div>

        <div class="footer">
            <p>Created by <a href="https://ko-fi.com/teamslide" target="_blank">Team Slide</a> | 
               <a href="https://innioasis.app" target="_blank">Innioasis App</a> | 
               <a href="https://innioasis.app" target="_blank">Slidia</a> | 
               <a href="https://discord.gg/Timmkoo" target="_blank">Discord</a></p>
            <p style="margin-top: 10px; font-size: 0.9rem; opacity: 0.7;">🍪 Cookies not used by this site</p>
        </div>
    </div>


    <!-- Platform-specific dialogs -->
    <div class="dialog-overlay" id="dialogOverlay"></div>
    
    <!-- Windows Dialog -->
    <div class="platform-dialog" id="windowsDialog">
        <h3>🪟 Windows Installation</h3>
        
        <!-- Step 1: Getting Started -->
        <div class="windows-step" id="windowsStep1">
            <div class="step-content">
                <h4>Getting Started</h4>
                <p>Before we can install the updater, you'll need two drivers so your computer can talk to your Y1 properly:</p>
                
                <div class="checklist">
                    <div class="checklist-item">
                        <div class="checklist-content">
                            <h5>📥 MediaTek Driver</h5>
                            <p>This helps your computer recognize your Y1 device</p>
                            <div class="checklist-actions">
                                <button class="btn btn-primary" onclick="downloadDriver('mtk')">Download MediaTek Driver</button>
                                <button class="info-btn" onclick="showDriverInfo()" title="Important installation info">Help</button>
                                <a href="#" onclick="markDriverComplete(); return false;" class="skip-link">Already done this</a>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="step-actions">
                    <button class="btn btn-primary" onclick="nextWindowsStep()">Next →</button>
                    <button class="btn btn-secondary" onclick="closeDialog()">Close</button>
                </div>
            </div>
        </div>
        
        <!-- Step 2: Install & Run -->
        <div class="windows-step" id="windowsStep2" style="display: none;">
            <div class="step-content">
                <h4>Install & Run</h4>
                <p>Now let's get the actual updater app:</p>
                <button class="btn btn-primary" onclick="downloadWindows()">📥 Download Windows Installer</button>
                
                <div class="step-actions">
                    <button class="btn btn-secondary" onclick="prevWindowsStep()">← Back</button>
                    <button class="btn btn-primary" onclick="nextWindowsStep()">Next →</button>
                </div>
            </div>
        </div>
        
        <!-- Step 3: Final Steps -->
        <div class="windows-step" id="windowsStep3" style="display: none;">
            <div class="step-content">
                <h4>Almost Done!</h4>
                <p>Here's what to do next:</p>
                <ol>
                    <li>Install the MediaTek driver you downloaded</li>
                    <li>Install the Innioasis Updater</li>
                    <li><strong>Restart your computer</strong></li>
                    <li>Launch Innioasis Updater from the Start Menu</li>
                </ol>
                
                <p><strong>Important:</strong> Don't skip the restart - it makes sure everything works properly!</p>
                
                <div class="step-actions">
                    <button class="btn btn-secondary" onclick="prevWindowsStep()">← Back</button>
                    <button class="btn btn-primary" onclick="closeDialog()">Finish</button>
                </div>
            </div>
        </div>
    </div>

    <!-- macOS Dialog -->
    <div class="platform-dialog" id="macDialog">
        <h3>🍎 macOS Installation</h3>
        
        <!-- Step 1: Prerequisites -->
        <div class="mac-step" id="macStep1">
            <div class="step-content">
                <h4>Prerequisites</h4>
                <p>Before installing Innioasis Updater, you'll need <a href="https://github.com/Homebrew/brew/releases/latest" target="_blank" class="homebrew-link">Homebrew</a> package manager on your Mac.</p>
                <p>Homebrew helps manage dependencies and ensures everything works smoothly.</p>
                
                <div class="step-actions">
                    <button class="btn btn-primary" onclick="nextMacStep()">Next →</button>
                    <button class="btn btn-secondary" onclick="closeDialog()">Close</button>
                </div>
            </div>
        </div>
        
        <!-- Step 2: Download -->
        <div class="mac-step" id="macStep2" style="display: none;">
            <div class="step-content">
                <h4>Download Innioasis Updater</h4>
                <p>Click the button below to download the macOS app package (.dmg file):</p>
                <button class="btn btn-primary" onclick="downloadMacDMG()">📥 Download for Mac</button>
                
                <div class="step-actions">
                    <button class="btn btn-secondary" onclick="prevMacStep()">← Back</button>
                    <button class="btn btn-primary" onclick="nextMacStep()">Next →</button>
                </div>
            </div>
        </div>
        
        <!-- Step 3: Installation -->
        <div class="mac-step" id="macStep3" style="display: none;">
            <div class="step-content">
                <h4>Install & Run</h4>
                <p>After downloading:</p>
                <ol>
                    <li>Double-click the .dmg file</li>
                    <li>Drag the Innioasis Updater app to your Applications folder</li>
                    <li>Launch the app from Applications</li>
                </ol>
                
                <p><strong>Note:</strong> You may need to <a href="#" id="appleGuideLink" target="_blank" class="apple-guide-link">allow apps from unknown developers</a> in System Preferences.</p>
                
                <div class="step-actions">
                    <button class="btn btn-secondary" onclick="prevMacStep()">← Back</button>
                    <button class="btn btn-primary" onclick="closeDialog()">Finish</button>
                </div>
            </div>
        </div>
        
        <!-- Alternative Install Method Link -->
        <div class="alternative-install">
            <a href="#" onclick="showMacTerminalInstall(); return false;" class="alternative-link">
                🔧 Alternative Install Method (Terminal)
            </a>
        </div>
    </div>

    <!-- Linux Dialog -->
    <div class="platform-dialog" id="linuxDialog">
        <h3>🐧 Linux Installation</h3>
        <p>Ubuntu is recommended for the best experience, but other distributions should work as well. Follow the instructions in the new tab to set up the required dependencies.</p>
        <button class="btn" onclick="openLinuxInstructions()">Open Instructions</button>
        <button class="btn btn-secondary" onclick="closeDialog()">Close</button>
    </div>

    <!-- ChromeOS/FydeOS Dialog -->
    <div class="platform-dialog" id="chromeosDialog">
        <h3>🖥️ ChromeOS/FydeOS</h3>
        <p>You MAY be able to run Innioasis Updater in Linux mode, but we have not tested this configuration. Follow the Linux instructions in the new tab and try running it in your Linux environment.</p>
        <p><em>Note: This is experimental and may not work as expected.</em></p>
        <button class="btn" onclick="openLinuxInstructions()">View Linux Instructions</button>
        <button class="btn btn-secondary" onclick="closeDialog()">Close</button>
    </div>

    <!-- Windows ARM64 Dialog -->
    <div class="platform-dialog" id="windowsArmDialog">
        <h3>🪟 Windows ARM64</h3>
        <p>For Windows ARM64 users, more advanced users may be able to run the Linux version using Python, Libusb, android-platform-tools, USBIPD-win and WSLg. Ubuntu is recommended.</p>
        <button class="btn" onclick="openLinuxInstructions()">View Linux Instructions</button>
        <button class="btn btn-secondary" onclick="closeDialog()">Close</button>
    </div>

    <!-- Platform Guides Dialog -->
    <div class="platform-dialog" id="platformGuidesDialog">
        <h3>🌍 Platform Setup Guides</h3>
        <p>Choose your platform to view detailed setup instructions:</p>
        <div class="platform-guides-grid">
            <button class="btn platform-guide-btn" onclick="navigateToPlatform('windowsDialog')">🪟 Windows</button>
            <button class="btn platform-guide-btn" onclick="navigateToPlatform('macDialog')">🍎 macOS</button>
            <button class="btn platform-guide-btn" onclick="navigateToPlatform('linuxDialog')">🐧 Linux</button>
        </div>
        <button class="btn btn-secondary" onclick="closeDialog()">Close</button>
    </div>

    <script>
        // Global variables
        let packages = [];
        let currentFilters = {
            deviceType: '',
            deviceModel: '',
            software: ''
        };

        // Function to parse version names and extract designations with flexible adjective handling
        function parseVersionDesignations(versionName) {
            const designations = [];
            
            // Define adjectives that can modify their nearest neighbor
            const adjectives = ['compatible', 'aware', 'supported', 'enabled', 'disabled', 'ready', 'optimized', 'enhanced'];
            
            // Extract only the part after the last dash (this is the actual version number)
            // First remove long hex strings at the end (like -13057e75dc29a1a7!)
            let cleanVersion = versionName.replace(/-[a-f0-9]{16,}!?$/, '');
            // Remove any remaining trailing dashes or exclamation marks
            cleanVersion = cleanVersion.replace(/[-!]+$/, '');
            
            // Extract only the numbers after the last dash
            if (cleanVersion.includes('-')) {
                const lastPart = cleanVersion.split('-').pop();
                // Check if the last part contains only numbers (and possibly dots)
                if (/^[\d.]+$/.test(lastPart)) {
                    cleanVersion = lastPart;
                }
            }
            
            // Parse designations from the original version name
            // Split by dashes and process each part
            const parts = versionName.split('-');
            
            for (let i = 0; i < parts.length; i++) {
                const part = parts[i];
                
                // Skip if it's the version number part
                if (/^[\d.]+$/.test(part)) {
                    continue;
                }
                
                // Skip if it's a hex string
                if (/^[a-f0-9]{16,}!?$/.test(part)) {
                    continue;
                }
                
                // Handle special cases first
                if (part === 'nightly') {
                    designations.push({
                        type: 'nightly',
                        text: 'Nightly'
                    });
                } else if (part === '360p') {
                    designations.push({
                        type: 'resolution-360p',
                        text: '360p'
                    });
                } else if (part === 'wifi' || part === 'wi-fi') {
                    designations.push({
                        type: 'wifi',
                        text: 'Wi-Fi'
                    });
                } else if (part === 'bluetooth') {
                    designations.push({
                        type: 'bluetooth',
                        text: 'Bluetooth'
                    });
                } else if (part === 'usb') {
                    designations.push({
                        type: 'usb',
                        text: 'USB'
                    });
                } else if (part === 'ethernet') {
                    designations.push({
                        type: 'ethernet',
                        text: 'Ethernet'
                    });
                } else if (part === 'hdmi') {
                    designations.push({
                        type: 'hdmi',
                        text: 'HDMI'
                    });
                } else if (part === 'audio') {
                    designations.push({
                        type: 'audio',
                        text: 'Audio'
                    });
                } else if (part === 'video') {
                    designations.push({
                        type: 'video',
                        text: 'Video'
                    });
                } else if (part === 'camera') {
                    designations.push({
                        type: 'camera',
                        text: 'Camera'
                    });
                } else if (part === 'gps') {
                    designations.push({
                        type: 'gps',
                        text: 'GPS'
                    });
                } else if (part === 'nfc') {
                    designations.push({
                        type: 'nfc',
                        text: 'NFC'
                    });
                } else if (part === 'lte') {
                    designations.push({
                        type: 'lte',
                        text: 'LTE'
                    });
                } else if (part === '5g') {
                    designations.push({
                        type: '5g',
                        text: '5G'
                    });
                } else if (part === 'ipod' && i + 1 < parts.length && parts[i + 1] === 'theme') {
                    // Handle "ipod-theme" case
                    if (i + 2 < parts.length && adjectives.includes(parts[i + 2])) {
                        // Check for adjective after "ipod-theme"
                        const adjective = parts[i + 2];
                        designations.push({
                            type: 'ipod-theme',
                            text: `iPod Themes ${adjective.charAt(0).toUpperCase() + adjective.slice(1)}`
                        });
                    } else {
                        designations.push({
                            type: 'ipod-theme',
                            text: 'iPod Themes'
                        });
                    }
                } else if (part === 'theme' && i > 0 && parts[i - 1] === 'ipod') {
                    // Skip this as it's handled above
                    continue;
                } else {
                    // Check if this part is followed by an adjective
                    if (i + 1 < parts.length && adjectives.includes(parts[i + 1])) {
                        const adjective = parts[i + 1];
                        // Capitalize the main part and add the adjective
                        const mainPart = part.replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
                        designations.push({
                            type: 'generic',
                            text: `${mainPart} ${adjective.charAt(0).toUpperCase() + adjective.slice(1)}`
                        });
                    } else {
                        // Just add the part as-is, capitalized
                        if (!adjectives.includes(part)) { // Don't add standalone adjectives
                            designations.push({
                                type: 'generic',
                                text: part.replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase())
                            });
                        }
                    }
                }
            }
            
            return {
                cleanVersion: cleanVersion.trim(),
                designations: designations
            };
        }

        // Function to format date in a fancy, simplified way without time
        function formatFancyDate(dateObj) {
            const now = new Date();
            const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
            const yesterday = new Date(today);
            yesterday.setDate(yesterday.getDate() - 1);
            
            const dateOnly = new Date(dateObj.getFullYear(), dateObj.getMonth(), dateObj.getDate());
            const todayOnly = new Date(today.getFullYear(), today.getMonth(), today.getDate());
            const yesterdayOnly = new Date(yesterday.getFullYear(), yesterday.getMonth(), yesterday.getDate());
            
            if (dateOnly.getTime() === todayOnly.getTime()) {
                return "Today";
            } else if (dateOnly.getTime() === yesterdayOnly.getTime()) {
                return "Yesterday";
            } else {
                const daysDiff = Math.floor((todayOnly - dateOnly) / (1000 * 60 * 60 * 24));
                
                if (daysDiff <= 7) {
                    // Within the last week - show day name
                    return dateObj.toLocaleDateString('en-US', { weekday: 'long' });
                } else if (daysDiff <= 30) {
                    // Within the last month - show month and day
                    return dateObj.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                } else {
                    // Older than a month - show month and year
                    return dateObj.toLocaleDateString('en-US', { month: 'short', year: 'numeric' });
                }
            }
        }

        // Function to get display version - either version number or published date
        function getDisplayVersion(versionInfo, publishedDate) {
            const versionText = versionInfo.cleanVersion;
            
            // If version is longer than 8 characters, use published date instead
            if (versionText.length > 8) {
                if (publishedDate) {
                    try {
                        const dateObj = new Date(publishedDate);
                        return formatFancyDate(dateObj);
                    } catch (e) {
                        return publishedDate;
                    }
                } else {
                    return "Unknown Date";
                }
            }
            
            return versionText;
        }
        

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            setupEventListeners();
            updateAvailableSoftwareTitle(); // Set initial title
            detectUserOS();
            checkSavedTheme();
            
            // Close driver info modal when clicking outside
            document.getElementById('driverInfoModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeDriverInfo();
                }
            });
        });

        // Detect user's operating system and update CTA banner
        function detectUserOS() {
            const userAgent = navigator.userAgent;
            let os = 'Windows';
            let isArm64 = false;
            
            if (userAgent.includes('Mac')) {
                os = 'macOS';
            } else if (userAgent.includes('Linux')) {
                os = 'Linux';
            } else if (userAgent.includes('CrOS') || userAgent.includes('FydeOS')) {
                os = 'ChromeOS/FydeOS';
            }
            
            // Check for Windows ARM64
            if (userAgent.includes('Windows') && (userAgent.includes('ARM64') || userAgent.includes('ARM'))) {
                isArm64 = true;
            }
            
            // Store platform info globally
            window.userPlatform = { os, isArm64 };
        }



        // Platform-specific download functions
        function downloadForPlatform() {
            const platform = window.userPlatform;
            
            if (platform.isArm64) {
                showDialog('windowsArmDialog');
            } else if (platform.os === 'Windows') {
                showDialog('windowsDialog');
            } else if (platform.os === 'macOS') {
                showDialog('macDialog');
            } else if (platform.os === 'Linux') {
                showDialog('linuxDialog');
            } else if (platform.os === 'ChromeOS/FydeOS') {
                showDialog('chromeosDialog');
            }
        }

        function downloadWindows() {
            // Download Windows installer
            const url = 'https://github.com/team-slide/Innioasis-Updater/releases/latest/download/Innioasis.Updater.-.Windows.exe';
            
            // For Safari, open in new tab, for other browsers use download attribute
            if (navigator.userAgent.includes('Safari') && !navigator.userAgent.includes('Chrome')) {
                window.open(url, '_blank');
                setTimeout(() => {
                    alert('🎉 Opening download page in new tab! Click the download button on the GitHub page.');
                }, 1000);
            } else {
                const link = document.createElement('a');
                link.href = url;
                link.download = 'Innioasis.Updater.-.Windows.exe';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                setTimeout(() => {
                    alert('🎉 Download started! The Windows installer is downloading to your Downloads folder.');
                }, 1000);
            }
            
            // Auto-advance to next step after a short delay
            setTimeout(() => {
                nextWindowsStep();
            }, 1500);
        }

        // Driver Info Modal Functions
        function showDriverInfo() {
            const modal = document.getElementById('driverInfoModal');
            if (modal) {
                modal.classList.add('show');
                document.body.style.overflow = 'hidden';
            }
        }

        function closeDriverInfo() {
            const modal = document.getElementById('driverInfoModal');
            if (modal) {
                modal.classList.remove('show');
                document.body.style.overflow = '';
            }
        }

        // Checklist Functions
        function markDriverComplete() {
            // Mark the driver as complete and move to next step
            const checklistItem = document.querySelector('.checklist-item');
            if (checklistItem) {
                checklistItem.style.opacity = '0.6';
                checklistItem.style.textDecoration = 'line-through';
                checklistItem.querySelector('.checklist-actions').innerHTML = '<span style="color: #28a745; font-weight: bold;">✓ Completed</span>';
            }
            
            // Auto-advance to next step after a short delay
            setTimeout(() => {
                nextWindowsStep();
            }, 1500);
        }

        function downloadDriver(driverType) {
            // Only handle MediaTek driver now
            if (driverType === 'mtk') {
                const url = 'https://github.com/team-slide/Innioasis-Updater/releases/latest/download/driver_mtk.exe';
                const filename = 'driver_mtk.exe';
                
                // For Safari, open in new tab, for other browsers use download attribute
                if (navigator.userAgent.includes('Safari') && !navigator.userAgent.includes('Chrome')) {
                    window.open(url, '_blank');
                    setTimeout(() => {
                        alert(`🎉 Opening MediaTek driver download page in new tab! Click the download button on the GitHub page.`);
                    }, 1000);
                } else {
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = filename;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    
                    setTimeout(() => {
                        alert(`🎉 Download started! The MediaTek driver is downloading to your Downloads folder.`);
                    }, 1000);
                }
            }
        }

        function openMacInstructions() {
            window.open('https://github.com/team-slide/Innioasis-Updater#manual-setup', '_blank');
        }

        function copyMacCommand() {
            const command = '/bin/bash -c "$(curl -fsSL https://mac.innioasis.app)"';
            
            if (navigator.clipboard && window.isSecureContext) {
                // Use modern clipboard API
                navigator.clipboard.writeText(command).then(() => {
                    showCopySuccess();
                }).catch(() => {
                    fallbackCopyTextToClipboard(command);
                });
            } else {
                // Fallback for older browsers
                fallbackCopyTextToClipboard(command);
            }
        }

        function fallbackCopyTextToClipboard(text) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.left = '-999999px';
            textArea.style.top = '-999999px';
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
                document.execCommand('copy');
                showCopySuccess();
            } catch (err) {
                console.error('Fallback: Oops, unable to copy', err);
            }
            
            document.body.removeChild(textArea);
        }

        function showCopySuccess() {
            const copyBtn = document.querySelector('.copy-btn');
            const originalText = copyBtn.textContent;
            copyBtn.textContent = '✅ Copied!';
            copyBtn.style.background = 'var(--accent-success)';
            
            setTimeout(() => {
                copyBtn.textContent = originalText;
                copyBtn.style.background = 'var(--accent-primary)';
            }, 2000);
        }

        function openLinuxInstructions() {
            window.open('https://github.com/team-slide/Innioasis-Updater#linux---ubuntu-recommended', '_blank');
        }

        function showDialog(dialogId) {
            document.getElementById('dialogOverlay').classList.add('show');
            document.getElementById(dialogId).classList.add('show');
            
            // Update Apple guide link if showing macOS dialog
            if (dialogId === 'macDialog') {
                updateAppleGuideLink();
            }
            
            // Initialize Windows steps if showing Windows dialog
            if (dialogId === 'windowsDialog') {
                // Hide all steps except first
                for (let i = 2; i <= 3; i++) {
                    document.getElementById(`windowsStep${i}`).style.display = 'none';
                }
                document.getElementById('windowsStep1').style.display = 'block';
            }
        }

        function closeDialog() {
            document.getElementById('dialogOverlay').classList.remove('show');
            document.querySelectorAll('.platform-dialog').forEach(dialog => {
                dialog.classList.remove('show');
            });
        }

        // Close dialog when clicking overlay
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('dialogOverlay').addEventListener('click', closeDialog);
            checkSavedTheme();
        });

        function updateAvailableSoftwareTitle() {
            const softwareSelect = document.getElementById('software');
            const titleElement = document.getElementById('availableSoftwareTitle');
            
            if (softwareSelect.value) {
                const selectedText = softwareSelect.options[softwareSelect.selectedIndex].text;
                titleElement.textContent = selectedText;
            } else {
                titleElement.textContent = 'Available System Software';
            }
        }

        function setupEventListeners() {
            document.getElementById('deviceType').addEventListener('change', function() {
                populateSoftwareCombo();
                filterFirmware();
            });
            document.getElementById('deviceModel').addEventListener('change', function() {
                populateSoftwareCombo();
                filterFirmware();
            });
            document.getElementById('software').addEventListener('change', function() {
                updateAvailableSoftwareTitle();
                filterFirmware();
            });
        }

        // Load config.ini tokens for API fallback
        let apiTokens = [];
        
        async function loadConfigTokens() {
            try {
                const response = await fetch('config.ini');
                if (!response.ok) {
                    console.warn('Could not load config.ini, using unauthenticated API calls only');
                    return [];
                }
                
                const configText = await response.text();
                const tokens = [];
                const lines = configText.split('\n');
                
                for (const line of lines) {
                    const trimmed = line.trim();
                    if (trimmed.startsWith('key_') && trimmed.includes('=')) {
                        const token = trimmed.split('=')[1].trim();
                        if (token && token.length > 10) {
                            tokens.push(token);
                        }
                    }
                }
                
                console.log(`Loaded ${tokens.length} API tokens from config.ini`);
                return tokens;
            } catch (error) {
                console.warn('Error loading config.ini:', error);
                return [];
            }
        }

        async function loadData() {
            try {
                setStatus('Loading configuration and manifest data...', 'loading');
                
                // Load API tokens first
                apiTokens = await loadConfigTokens();
                
                // Load manifest data
                const manifestResponse = await fetch('https://raw.githubusercontent.com/team-slide/slidia/refs/heads/main/slidia_manifest.xml');
                if (!manifestResponse.ok) {
                    throw new Error('Failed to load manifest');
                }
                
                const manifestText = await manifestResponse.text();
                packages = parseManifest(manifestText);
                
                if (packages.length === 0) {
                    throw new Error('No packages found in manifest');
                }
                
                console.log(`Loaded ${packages.length} software packages`);
                
                // Populate filters
                populateDeviceTypeCombo();
                populateDeviceModelCombo();
                populateSoftwareCombo();
                
                // Apply default filters and load firmware
                filterFirmware();
                
                // Load initial firmware list
                await loadFirmwareList();
                
                setStatus('Ready to download firmware');
                
            } catch (error) {
                console.error('Error loading data:', error);
                setStatus(`Error loading data: ${error.message}`, 'error');
            }
        }

        
        
        
        
        
        
        function parseManifest(xmlText) {
            const parser = new DOMParser();
            const xmlDoc = parser.parseFromString(xmlText, 'text/xml');
            const packageElements = xmlDoc.getElementsByTagName('package');
            
            const packages = [];
            for (let pkg of packageElements) {
                packages.push({
                    name: pkg.getAttribute('name') || 'Unknown',
                    device_type: pkg.getAttribute('device_type') || '',
                    repo: pkg.getAttribute('repo') || '',
                    device: pkg.getAttribute('device') || '',
                    url: pkg.getAttribute('url') || '',
                    type: pkg.getAttribute('type') || '',
                    handler: pkg.getAttribute('handler') || ''
                });
            }
            
            return packages;
        }

        function populateDeviceTypeCombo() {
            const combo = document.getElementById('deviceType');
            const deviceTypes = [...new Set(packages.map(p => p.device_type).filter(t => t))];
            
            combo.innerHTML = '';
            deviceTypes.sort().forEach(type => {
                const option = document.createElement('option');
                option.value = type;
                option.textContent = `Type ${type}`;
                // Set Type A as default
                if (type && type.toLowerCase().includes('a')) {
                    option.selected = true;
                }
                combo.appendChild(option);
            });
        }

        function populateDeviceModelCombo() {
            const combo = document.getElementById('deviceModel');
            const deviceModels = [...new Set(packages.map(p => p.device).filter(m => m))];
            
            combo.innerHTML = '<option value="">All Models</option>';
            deviceModels.sort().forEach(model => {
                const option = document.createElement('option');
                option.value = model;
                option.textContent = model;
                // Set Y1 as default
                if (model && model.toLowerCase().includes('y1')) {
                    option.selected = true;
                }
                combo.appendChild(option);
            });
        }

        function populateSoftwareCombo() {
            const combo = document.getElementById('software');
            const selectedType = document.getElementById('deviceType').value;
            const selectedModel = document.getElementById('deviceModel').value;
            
            // Get filtered software names based on current device type and model selections
            const filteredPackages = packages.filter(package => {
                const typeMatch = !selectedType || package.device_type === selectedType;
                const modelMatch = !selectedModel || package.device === selectedModel;
                return typeMatch && modelMatch;
            });
            
            const softwareNames = [...new Set(filteredPackages.map(p => p.name).filter(n => n))];
            
            combo.innerHTML = '';
            softwareNames.sort().forEach(name => {
                const option = document.createElement('option');
                option.value = name;
                option.textContent = name;
                // Set Original as default
                if (name && name.toLowerCase().includes('original')) {
                    option.selected = true;
                }
                combo.appendChild(option);
            });
        }

        function filterFirmware() {
            currentFilters.deviceType = document.getElementById('deviceType').value;
            currentFilters.deviceModel = document.getElementById('deviceModel').value;
            currentFilters.software = document.getElementById('software').value;
            
            loadFirmwareList();
        }

        async function loadFirmwareList() {
            try {
                setStatus('Loading firmware releases...', 'loading');
                
                const container = document.getElementById('firmwareContainer');
                container.innerHTML = '<div class="loading-spinner"></div> Loading...';
                
                // Get filtered packages
                const filteredPackages = packages.filter(pkg => {
                    const typeMatch = !currentFilters.deviceType || pkg.device_type === currentFilters.deviceType;
                    const modelMatch = !currentFilters.deviceModel || pkg.device === currentFilters.deviceModel;
                    const softwareMatch = !currentFilters.software || pkg.name === currentFilters.software;
                    
                    return typeMatch && modelMatch && softwareMatch;
                });
                
                if (filteredPackages.length === 0) {
                    container.innerHTML = '<p style="text-align: center; color: #6c757d;">No firmware found matching the selected filters</p>';
                    setStatus('No firmware found');
                    return;
                }
                
                // Group packages by repo to minimize API calls
                const repoGroups = {};
                filteredPackages.forEach(pkg => {
                    if (!repoGroups[pkg.repo]) {
                        repoGroups[pkg.repo] = [];
                    }
                    repoGroups[pkg.repo].push(pkg);
                });
                
                // Load releases for each unique repo (batch requests)
                const allReleases = [];
                const repoPromises = Object.keys(repoGroups).map(async (repo) => {
                    try {
                        const releases = await getReleases(repo);
                        releases.forEach(release => {
                            // Add metadata for all packages that use this repo
                            repoGroups[repo].forEach(pkg => {
                                const releaseWithMetadata = {
                                    ...release,
                                    software_name: pkg.name,
                                    device_type: pkg.device_type,
                                    device_model: pkg.device
                                };
                                allReleases.push(releaseWithMetadata);
                            });
                        });
                    } catch (error) {
                        console.warn(`Failed to load releases for ${repo}:`, error);
                    }
                });
                
                // Wait for all repo requests to complete
                await Promise.all(repoPromises);
                
                // Sort releases by date (newest first)
                allReleases.sort((a, b) => new Date(b.published_at) - new Date(a.published_at));
                
                // Display releases
                displayFirmwareList(allReleases);
                setStatus(`Loaded ${allReleases.length} firmware releases`);
                
            } catch (error) {
                console.error('Error loading firmware list:', error);
                setStatus(`Error loading firmware: ${error.message}`, 'error');
                document.getElementById('firmwareContainer').innerHTML = 
                    '<p style="text-align: center; color: #c0392b;">Failed to load firmware list</p>';
            }
        }

        async function getReleases(repo) {
            try {
                // Try unauthenticated API call first
                let response = await fetch(`https://api.github.com/repos/${repo}/releases`);
                
                // If rate limited and we have tokens, try with authentication
                if (response.status === 403 && apiTokens.length > 0) {
                    console.log(`Rate limited for ${repo}, trying with authentication...`);
                    const randomToken = apiTokens[Math.floor(Math.random() * apiTokens.length)];
                    response = await fetch(`https://api.github.com/repos/${repo}/releases`, {
                        headers: {
                            'Authorization': `token ${randomToken}`,
                            'Accept': 'application/vnd.github.v3+json'
                        }
                    });
                }
                
                if (!response.ok) {
                    throw new Error(`GitHub API error: ${response.status}`);
                }
                
                const releases = await response.json();
                return releases
                    .filter(release => {
                        // Only include releases that have a rom.zip file
                        const hasRomZip = release.assets && release.assets.some(asset => 
                            asset.name && asset.name.toLowerCase() === 'rom.zip'
                        );
                        return hasRomZip;
                    })
                    .map(release => {
                        // Find the rom.zip asset and get its download count
                        const romZipAsset = release.assets.find(asset => 
                            asset.name && asset.name.toLowerCase() === 'rom.zip'
                        );
                        
                        return {
                            tag_name: release.tag_name,
                            name: release.name || release.tag_name,
                            published_at: release.published_at,
                            html_url: release.html_url,
                            assets: release.assets || [],
                            download_count: romZipAsset ? romZipAsset.download_count : 0,
                            total_downloads: release.assets.reduce((sum, asset) => sum + (asset.download_count || 0), 0)
                        };
                    });
            } catch (error) {
                console.warn(`Failed to fetch releases for ${repo}:`, error);
                return [];
            }
        }

        function displayFirmwareList(releases) {
            const container = document.getElementById('firmwareContainer');
            
            if (releases.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #6c757d;">No releases found</p>';
                return;
            }
            
            container.innerHTML = releases.map(release => {
                // Parse version designations
                const versionInfo = parseVersionDesignations(release.tag_name);
                const displayVersion = getDisplayVersion(versionInfo, release.published_at);
                const versionNeedsScrolling = displayVersion.length > 25;
                
                // Format download counts
                const formatDownloadCount = (count) => {
                    if (count >= 1000000) {
                        return (count / 1000000).toFixed(1) + 'M';
                    } else if (count >= 1000) {
                        return (count / 1000).toFixed(1) + 'K';
                    }
                    return count.toString();
                };
                
                // Generate pills HTML
                const pillsHTML = versionInfo.designations.length > 0 ? 
                    `<div class="version-pills">
                        ${versionInfo.designations.map(designation => 
                            `<span class="version-pill ${designation.type}">${designation.text}</span>`
                        ).join('')}
                    </div>` : '';
                
                // Add software name detail
                const softwareHTML = `<div class="detail-item">
                    <div class="detail-label">Software</div>
                    <div class="detail-value">${release.software_name}</div>
                </div>`;
                
                // Only show released date if we're using version number as title
                const releasedDateHTML = versionInfo.cleanVersion.length <= 8 ? 
                    `<div class="detail-item">
                        <div class="detail-label">Released</div>
                        <div class="detail-value">${formatDate(release.published_at)}</div>
                    </div>` : '';
                
                return `
                    <div class="firmware-item" onclick="selectFirmware(this, '${release.software_name}')">
                        <div class="firmware-name">${displayVersion}</div>
                        <div class="firmware-details">
                            ${softwareHTML}
                            ${pillsHTML}
                            ${releasedDateHTML}
                            <div class="detail-item">
                                <div class="detail-label">Downloads</div>
                                <div class="detail-value">${formatDownloadCount(release.download_count || 0)}</div>
                            </div>
                            ${!currentFilters.deviceType ? `<div class="detail-item">
                                <div class="detail-label">Type</div>
                                <div class="detail-value">${release.device_type || 'N/A'}</div>
                            </div>` : ''}
                            ${!currentFilters.deviceModel ? `<div class="detail-item">
                                <div class="detail-label">Model</div>
                                <div class="detail-value">${release.device_model || 'N/A'}</div>
                            </div>` : ''}
                        </div>
                        <div class="download-section">
                            <button class="whats-new-btn" onclick="showWhatsNew('${release.html_url}', '${release.tag_name}')">
                                📋 What's New
                            </button>
                            <button class="automatic-install-btn" onclick="goToInnioasisApp(event)">
                                ⚡ Get Innioasis Updater
                            </button>
                            <button class="download-rom-btn" onclick="downloadROM('${release.html_url}', event)">
                                📦 view on GitHub repo
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
            
            // Add touch handling for scrolling text and check if scrolling is actually needed
            setTimeout(() => {
                document.querySelectorAll('.firmware-item').forEach(item => {
                    handleScrollingTextTouch(item);
                    checkAndAdjustScrolling(item);
                });
            }, 100);
        }

        function selectFirmware(element, softwareName) {
            // Remove previous selection
            document.querySelectorAll('.firmware-item').forEach(item => {
                item.classList.remove('selected');
            });
            
            // Add selection to clicked item
            element.classList.add('selected');
        }

        // Handle touch interactions for scrolling text
        function handleScrollingTextTouch(element) {
            const scrollTexts = element.querySelectorAll('.scroll-text');
            scrollTexts.forEach(textElement => {
                textElement.addEventListener('touchstart', function() {
                    this.style.animationPlayState = 'paused';
                });
                
                textElement.addEventListener('touchend', function() {
                    setTimeout(() => {
                        this.style.animationPlayState = 'running';
                    }, 1000);
                });
            });
        }

        // Toggle scrolling animation
        function toggleScrollingAnimation(element) {
            const scrollTexts = element.querySelectorAll('.scroll-text');
            scrollTexts.forEach(textElement => {
                if (textElement.style.animationPlayState === 'paused') {
                    textElement.style.animationPlayState = 'running';
                } else {
                    textElement.style.animationPlayState = 'paused';
                }
            });
        }

        // Check if scrolling is actually needed based on element width
        function checkAndAdjustScrolling(element) {
            const scrollTexts = element.querySelectorAll('.scroll-text');
            scrollTexts.forEach(textElement => {
                // Temporarily remove scroll class to measure natural width
                const hasScrollClass = textElement.classList.contains('scroll-text');
                if (hasScrollClass) {
                    textElement.classList.remove('scroll-text');
                    textElement.style.whiteSpace = 'nowrap';
                    
                    const naturalWidth = textElement.scrollWidth;
                    const containerWidth = textElement.offsetWidth;
                    
                    // Only add scrolling if text is actually wider than container
                    if (naturalWidth > containerWidth + 10) { // 10px buffer
                        textElement.classList.add('scroll-text');
                    } else {
                        // Text fits, remove scrolling and restore normal wrapping
                        textElement.style.whiteSpace = 'normal';
                        textElement.style.maxWidth = 'none';
                    }
                }
            });
        }

        function showWhatsNew(htmlUrl, tagName) {
            // Extract repository info from HTML URL
            const urlParts = htmlUrl.split('/');
            const repo = `${urlParts[3]}/${urlParts[4]}`;
            
            // Create modal for release notes
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal-content whats-new-modal">
                    <div class="modal-header">
                        <h3>What's New in ${tagName}</h3>
                        <button class="close-btn" onclick="closeWhatsNew()">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div class="loading-spinner">Loading release notes...</div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Fetch release notes from GitHub API
            fetch(`https://api.github.com/repos/${repo}/releases/tags/${tagName}`)
                .then(response => response.json())
                .then(data => {
                    const body = modal.querySelector('.modal-body');
                    if (data.body) {
                        // Convert markdown to HTML (basic conversion)
                        const html = data.body
                            .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                            .replace(/\*(.*?)\*/g, '<em>$1</em>')
                            .replace(/`(.*?)`/g, '<code>$1</code>')
                            .replace(/^### (.*$)/gim, '<h3>$1</h3>')
                            .replace(/^## (.*$)/gim, '<h2>$1</h2>')
                            .replace(/^# (.*$)/gim, '<h1>$1</h1>')
                            .replace(/^\* (.*$)/gim, '<li>$1</li>')
                            .replace(/^- (.*$)/gim, '<li>$1</li>')
                            .replace(/\n\n/g, '</p><p>')
                            .replace(/\n/g, '<br>');
                        
                        body.innerHTML = `<div class="release-notes">${html}</div>`;
                    } else {
                        body.innerHTML = '<p>No release notes available for this version.</p>';
                    }
                })
                .catch(error => {
                    const body = modal.querySelector('.modal-body');
                    body.innerHTML = '<p>Error loading release notes. Please try again later.</p>';
                    console.error('Error fetching release notes:', error);
                });
        }

        function closeWhatsNew() {
            const modal = document.querySelector('.modal-overlay');
            if (modal) {
                document.body.removeChild(modal);
            }
        }

        function downloadROM(releasesUrl, event) {
            event.stopPropagation();
            
            // Extract repo and tag from the releases URL
            const urlParts = releasesUrl.split('/');
            const repoIndex = urlParts.findIndex(part => part === 'github.com') + 1;
            const repo = `${urlParts[repoIndex]}/${urlParts[repoIndex + 1]}`;
            const tag = urlParts[urlParts.length - 1];
            
            // Construct direct download URL for rom.zip
            const downloadUrl = `https://github.com/${repo}/releases/download/${tag}/rom.zip`;
            
            // Create a temporary link element to trigger download
            const link = document.createElement('a');
            link.href = downloadUrl;
            link.download = `rom-${tag}.zip`;
            link.style.display = 'none';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            // Show success message
            setStatus(`Downloading rom.zip from ${repo}...`, 'loading');
            setTimeout(() => {
                setStatus('ROM download started successfully');
            }, 1000);
        }

        function goToInnioasisApp(event) {
            event.stopPropagation();
            
            // Direct users to the install guide for automatic installation
            window.open('https://innioasis.app', '_blank');
        }

        function formatDate(dateString) {
            try {
                const date = new Date(dateString);
                return formatFancyDate(date);
            } catch (error) {
                return dateString;
            }
        }

        function setStatus(message, type = '') {
            const statusElement = document.getElementById('status');
            statusElement.textContent = message;
            statusElement.className = `status ${type}`;
        }

        function refreshData() {
            loadData();
        }

        // Handle errors gracefully
        window.addEventListener('error', function(e) {
            console.error('Global error:', e.error);
            setStatus('An unexpected error occurred', 'error');
        });

        // Handle unhandled promise rejections
        window.addEventListener('unhandledrejection', function(e) {
            console.error('Unhandled promise rejection:', e.reason);
            setStatus('Network or API error occurred', 'error');
        });

        // macOS Step Navigation Functions
        function downloadMacDMG() {
            // Download macOS DMG installer
            const url = 'https://github.com/team-slide/Innioasis-Updater/releases/latest/download/Innioasis.Updater.for.Mac.dmg';
            
            // For Safari, open in new tab, for other browsers use download attribute
            if (navigator.userAgent.includes('Safari') && !navigator.userAgent.includes('Chrome')) {
                window.open(url, '_blank');
                setTimeout(() => {
                    alert('🎉 Opening download page in new tab! Click the download button on the GitHub page.');
                }, 1000);
            } else {
                const link = document.createElement('a');
                link.href = url;
                link.download = 'Innioasis.Updater.for.Mac.dmg';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                setTimeout(() => {
                    alert('🎉 Download started! The DMG file is downloading to your Downloads folder.');
                }, 1000);
            }
            
            // Auto-advance to next step after a short delay
            setTimeout(() => {
                nextMacStep();
            }, 1500);
        }

        function nextMacStep() {
            const currentStep = getCurrentMacStep();
            if (currentStep < 3) {
                hideMacStep(currentStep);
                showMacStep(currentStep + 1);
                updateAppleGuideLink();
            }
        }

        function prevMacStep() {
            const currentStep = getCurrentMacStep();
            if (currentStep > 1) {
                hideMacStep(currentStep);
                showMacStep(currentStep - 1);
            }
        }

        function getCurrentMacStep() {
            for (let i = 1; i <= 3; i++) {
                if (document.getElementById(`macStep${i}`).style.display !== 'none') {
                    return i;
                }
            }
            return 1;
        }

        function showMacStep(stepNumber) {
            document.getElementById(`macStep${stepNumber}`).style.display = 'block';
        }

        function hideMacStep(stepNumber) {
            document.getElementById(`macStep${stepNumber}`).style.display = 'none';
        }

        function updateAppleGuideLink() {
            // Get macOS version and update the Apple guide link
            const userAgent = navigator.userAgent;
            let macVersion = '14.0'; // Default to macOS 14
            
            if (userAgent.includes('Mac OS X 10_15')) {
                macVersion = '10.15'; // macOS Catalina
            } else if (userAgent.includes('Mac OS X 11_')) {
                macVersion = '11.0'; // macOS Big Sur
            } else if (userAgent.includes('Mac OS X 12_')) {
                macVersion = '12.0'; // macOS Monterey
            } else if (userAgent.includes('Mac OS X 13_')) {
                macVersion = '13.0'; // macOS Ventura
            } else if (userAgent.includes('Mac OS X 14_')) {
                macVersion = '14.0'; // macOS Sonoma
            } else if (userAgent.includes('Mac OS X 15_')) {
                macVersion = '15.0'; // macOS Sequoia
            }
            
            const appleGuideLink = document.getElementById('appleGuideLink');
            if (appleGuideLink) {
                appleGuideLink.href = `https://support.apple.com/en-gb/guide/mac-help/mh40616/${macVersion}/mac/${macVersion}`;
            }
        }

        function showMacTerminalInstall() {
            // Show terminal installation method
            const terminalDialog = document.createElement('div');
            terminalDialog.className = 'platform-dialog show';
            terminalDialog.innerHTML = `
                <h3>🍎 App not working?</h3>
                <p>Try running this command in Terminal:</p>
                <div class="command-display">
                    <code>curl -fsSL https://mac.innioasis.app | bash</code>
                </div>
                <button class="btn" onclick="copyMacCommand()">📋 Copy Command</button>
                <button class="btn btn-secondary" onclick="closeTerminalDialog()">Close</button>
            `;
            
            document.body.appendChild(terminalDialog);
            document.getElementById('dialogOverlay').classList.add('show');
        }

        function closeTerminalDialog() {
            const terminalDialog = document.querySelector('.platform-dialog.show:not(#macDialog)');
            if (terminalDialog) {
                terminalDialog.remove();
            }
            document.getElementById('dialogOverlay').classList.remove('show');
        }

        // Navigate between platform dialogs
        function navigateToPlatform(dialogId) {
            // Close the platform guides dialog
            closeDialog();
            // Show the selected platform dialog
            setTimeout(() => {
                showDialog(dialogId);
            }, 100);
        }

        // Windows Step Navigation Functions
        function nextWindowsStep() {
            const currentStep = getCurrentWindowsStep();
            if (currentStep < 3) {
                hideWindowsStep(currentStep);
                showWindowsStep(currentStep + 1);
            }
        }

        function prevWindowsStep() {
            const currentStep = getCurrentWindowsStep();
            if (currentStep > 1) {
                hideWindowsStep(currentStep);
                showWindowsStep(currentStep - 1);
            }
        }

        function getCurrentWindowsStep() {
            for (let i = 1; i <= 3; i++) {
                if (document.getElementById(`windowsStep${i}`).style.display !== 'none') {
                    return i;
                }
            }
            return 1;
        }

        function showWindowsStep(stepNumber) {
            document.getElementById(`windowsStep${stepNumber}`).style.display = 'block';
        }

        function hideWindowsStep(stepNumber) {
            document.getElementById(`windowsStep${stepNumber}`).style.display = 'none';
        }

        // Theme toggle functionality - cycles through Auto → Light → Dark
        function toggleTheme() {
            const body = document.body;
            const themeToggle = document.querySelector('.theme-toggle');
            const icon = themeToggle.querySelector('.icon');
            const text = themeToggle.querySelector('span:not(.icon)');
            const currentTheme = localStorage.getItem('theme') || 'auto';
            
            let newTheme;
            if (currentTheme === 'auto') {
                newTheme = 'light';
            } else if (currentTheme === 'light') {
                newTheme = 'dark';
            } else {
                newTheme = 'auto';
            }
            
            localStorage.setItem('theme', newTheme);
            applyTheme(newTheme);
        }

        // Apply the specified theme
        function applyTheme(theme) {
            const body = document.body;
            const themeToggle = document.querySelector('.theme-toggle');
            const icon = themeToggle.querySelector('.icon');
            const text = themeToggle.querySelector('span:not(.icon)');
            
            if (theme === 'auto') {
                // Check system preference
                if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                    body.setAttribute('data-theme', 'dark');
                    icon.textContent = '🌓';
                    text.textContent = 'Auto';
                } else {
                    body.removeAttribute('data-theme');
                    icon.textContent = '🌓';
                    text.textContent = 'Auto';
                }
            } else if (theme === 'dark') {
                body.setAttribute('data-theme', 'dark');
                icon.textContent = '☀️';
                text.textContent = 'Light';
            } else {
                body.removeAttribute('data-theme');
                icon.textContent = '🌙';
                text.textContent = 'Dark';
            }
        }

        // Check saved theme preference and system theme
        function checkSavedTheme() {
            const savedTheme = localStorage.getItem('theme') || 'auto';
            applyTheme(savedTheme);
            
            // Listen for system theme changes when in auto mode
            if (savedTheme === 'auto') {
                window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', e => {
                    if (localStorage.getItem('theme') === 'auto') {
                        if (e.matches) {
                            document.body.setAttribute('data-theme', 'dark');
                        } else {
                            document.body.removeAttribute('data-theme');
                        }
                    }
                });
            }
        }
    </script>

    <!-- Ko-Fi Floating Chat Widget -->
    <script src='https://storage.ko-fi.com/cdn/scripts/overlay-widget.js'></script>
    <script>
      kofiWidgetOverlay.draw('teamslide', {
        'type': 'floating-chat',
        'floating-chat.donateButton.text': 'Support me',
        'floating-chat.donateButton.background-color': '#00b9fe',
        'floating-chat.donateButton.text-color': '#fff'
      });
    </script>
</body>
</html>
